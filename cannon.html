<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chicken Attack Game</title>

  <!-- style -->
  <link rel="stylesheet" href="style.css">

  <!-- jQuery ثم محرّك اللعبة -->
  <script defer src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script defer src="cannon.js"></script>
</head>

<body id="body">

<!-- Menu -->
<div class="menu">
  <button onclick="showSection('welcomeSection')">Welcome</button>
</div>

<!-- Welcome Section -->
<div id="welcomeSection" class="section" style="display:block;">
  <h1>Greetings from Chicken Invaders!</h1>
  <p class="teamMembers">
    Team Members: Aseel Zatout 322847633, Jawad Dabbah 323086330, Hasan Diab 213017429
  </p>

  <div class="welcomeButtons">
    <div class="aboutArea">
      <button onclick="showSection('aboutSection')">About</button>
      <span class="smallText">About us!</span>
    </div><br><br>

    <div class="registerArea">
      <button onclick="showSection('registerSection')">Register</button>
      <span class="smallText">Don't have an account yet? Sign in here</span>
    </div><br><br>

    <div class="loginArea">
      <button onclick="showSection('loginSection')">Login</button>
      <span class="smallText">In order to start the game you need to log in</span>
    </div>
  </div>
</div>

<!-- About Section -->
<div id="aboutSection" class="section" style="display:none;"></div>

<!-- Register Section -->
<div id="registerSection" class="section" style="display: none;">
   <h2>Register</h2>
   <form onsubmit="signup(); return false;">
     <input id="username" type="text" placeholder="Username" required><br><br>
     <input id="Password" type="password" placeholder="Password" required><br><br>
     <input id="confirmPass" type="password" placeholder="Confirm Password" required><br><br>
     <input id="Firstname" type="text" placeholder="First Name" required><br><br>
     <input id="Lastname" type="text" placeholder="Last Name" required><br><br>
     <input id="email" type="email" placeholder="Email" required><br><br>
     <input id="bdate" type="text" placeholder="DD/MM/YYYY" required><br><br>
 
     <button type="submit">Sign Up</button>
   </form>
 </div>

<!-- Login Section -->
<div id="loginSection" class="section" style="display: none;">
   <h2>Login</h2>
   <form onsubmit="login(); return false;">
     <input id="LoginUsername" type="text" placeholder="Username" required><br><br>
     <input id="Loginpass" type="password" placeholder="Password" required><br><br>
     <button type="submit">Log In</button>
   </form>
 </div>

<!-- Configuration Section -->
<div id="configSection" class="section" style="display:none;">
  <h2>Configuration Settings</h2>
  <form id="configForm" autocomplete="off">
    <label>Choose Shooting Key (letter or Space):<br>
      <input id="shootKey" type="text" maxlength="1" placeholder="Key" required>
    </label><br><br>
    <label>Set Game Time (minutes ≥2):<br>
      <input id="gameTime" type="number" min="2" placeholder="Minutes" required>
    </label><br><br>
    <label>Choose Ship Color:<br>
      <input id="shipColor" type="color" value="#ffffff">
    </label><br><br>
    <button type="button" onclick="showGameScreen()">Start Game</button>
  </form>
</div>

<!-- GAME SCREEN -->
<div class="Game_Screen" style="display:none;">
  <div class="score"><span>Score: </span><span class="score-num">0</span></div><br><br>
  <div class="time"><span>Time: </span><span class="time-num">0</span></div>

  <canvas class="canvas" id="canvas"></canvas>

  <div class="result" style="display:none;">
    <div class="game-over">
      <h1 id="status"></h1>
      <h2 class="score-num">0</h2>
      <p>Points</p>
      <button class="start-game-btn">Restart</button>
      <button class="leaderBoardBtn">Leader Board</button>
    </div>
  </div>
</div>

<!-- Leaderboard Section -->
<div class="leaderboard-container" style="display:none;">
  <h2>Leaderboard</h2>
  <table class="leaderboard-table">
    <thead><tr><th>Player</th><th>Score</th></tr></thead>
    <tbody id="table_body"></tbody>
  </table>
</div>

<!-- Inline helpers -->
<script>
/* built-in demo user */
const players = { p: "testuser" };
let currentPlayer = null;
const scores = [];

/* globals used by cannon.js */
shoot_key = " ";
timeLeft1 = 120;
shipColor = "#ffffff";


/* section switching */
function showSection(id){
  ['welcomeSection','aboutSection','registerSection',
   'loginSection','configSection'].forEach(sec=>{
      document.getElementById(sec).style.display = (sec===id?'block':'none');
  });
  if(id==='aboutSection')
    $('#aboutSection').html('<h1>About Chicken Attack</h1><p>Enjoy!</p>');
}

/* signup */
function signup(){
  const [u,p,cp,f,l,e,b] =
    ['username','Password','confirmPass','Firstname',
     'Lastname','email','bdate'].map(i=>$('#'+i).val().trim());

  if([u,p,cp,f,l,e,b].includes(""))      return alert("Fill all fields!");
  if(!/^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d]{8,}$/.test(p))
    return alert("Password ≥8 chars with letters+digits");
  if(p!==cp)                            return alert("Passwords mismatch");
  if(!/^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/.test(e))
    return alert("Invalid email");

  players[u]=p; alert("Registration successful!"); showSection('welcomeSection');
}

/* login */
function login(){
  const u=$('#LoginUsername').val().trim(),
        p=$('#Loginpass').val().trim();
  if(!(u in players))    return alert("User not found");
  if(players[u]!==p)     return alert("Wrong password");
  currentPlayer=u; scores.length=0; showSection('configSection');
}

/* start game */
function showGameScreen () {
  const key = $('#shootKey').val().trim() || ' ',
        t   = parseInt($('#gameTime').val(), 10),
        col = $('#shipColor').val();

  if ((key.length !== 1 && key !== ' ') || t < 2) {
    return alert('Fix inputs');
  }

  shoot_key = (key === ' ') ? ' ' : key.toLowerCase();
  timeLeft1 = t * 60;          // minutes → seconds
  shipColor = col;

  // hide every other section + the top menu, then show the canvas
  $('.section, .menu').hide();
  $('.Game_Screen').show();

  // remove galaxy wallpaper so only the canvas appears
  document.getElementById('body').style.backgroundImage = 'none';

  initGame();        // defined in cannon.js
}

</script>

</body>
</html>
